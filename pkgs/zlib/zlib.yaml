extends: [autotools_package]

sources:
- key: tar.gz:sgceqcctfzoogfvtyaijffetyase6pjx
  url: https://zlib.net/zlib-1.2.12.tar.gz


build_stages:
- name: setEnv
  before: configure
  handler: bash
  bash: |
    export CFLAGS="-fPIC"

- name: configure
  after: prologue
  extra: ['--enable-shared']

- when: platform == 'Cygwin'
  files: [zlib-cygwin.patch]
  name: zlib-cygwin
  handler: bash
  before: configure
  bash: |
    patch -p1 < _hashdist/zlib-cygwin.patch

- when: platform == 'Cygwin'
  name: configure
  mode: replace
  after: prologue
  handler: bash
  bash: |
    # nothing to configure...

- when: platform == 'Cygwin'
  name: make
  handler: bash
  bash: |
    make -fwin32/Makefile.gcc

- when: platform == 'Cygwin'
  name: install
  handler: bash
  bash: |
    make install -fwin32/Makefile.gcc SHARED_MODE=1 SHAREDLIB=cygz.dll DESTDIR=${ARTIFACT}/ BINARY_PATH=bin INCLUDE_PATH=include LIBRARY_PATH=lib


- name: setEnv
  before: configure
  handler: bash
  bash: |
    unset CC CFLAGS

- name: configure
  after: prologue
  extra: ['--enable-shared']

